# 評分偏高問題分析

## 問題：紀律和出場分數普遍偏高

### 原因分析

#### 1. 加分項太多，扣分項太少

**出場質量**：
- 加分項：優秀收益 +20、良好收益 +10、不錯收益 +5、優秀盈虧比 +10、良好盈虧比 +5、嚴格止損 +10
- 扣分項：收益不足 -20、虧損過大 -35

**問題**：
- 只要獲利就容易加分
- 虧損才扣分
- 導致獲利交易分數都很高

**紀律遵守**：
- 加分項：自動平倉 +15、持倉合理 +5
- 扣分項：爆倉 = 0、手動平倉 -30/-15/-5

**問題**：
- 只要不爆倉、不手動平倉，就能拿到加分
- 大部分交易都能拿 100+ 分

---

#### 2. 初始分數太高（100分）

**當前邏輯**：
```python
entry_score = 100.0
exit_score = 100.0
risk_score = 100.0
discipline_score = 100.0
```

**問題**：
- 從 100 分開始，默認所有交易都是完美的
- 只有做錯事才扣分
- 導致平庸的交易也能拿高分

---

#### 3. 加分上限（100分）太容易達到

**當前邏輯**：
```python
exit_score = min(100, exit_score + 20)  # 上限 100
```

**問題**：
- 只要有一兩個加分項，就能達到 100 分
- 無法區分「好」和「非常好」的交易

---

## 解決方案

### 方案 1：降低初始分數（推薦）

**改為從 70 分開始**：
```python
entry_score = 70.0  # 及格分
exit_score = 70.0
risk_score = 70.0
discipline_score = 70.0
```

**邏輯**：
- 70 分 = 及格（普通交易）
- 需要做對事情才能加分到 80-90
- 做錯事情會扣分到 60 以下

**評分等級**：
- 90-100：優秀（需要多個加分項）
- 80-89：良好（有一些加分項）
- 70-79：及格（普通交易）
- 60-69：需改進（有扣分項）
- < 60：不及格（嚴重問題）

---

### 方案 2：提高加分上限

**改為上限 120 分**：
```python
exit_score = min(120, exit_score + 20)  # 上限 120
```

**邏輯**：
- 允許優秀交易超過 100 分
- 最終總分仍然是 4 項平均

**問題**：
- 可能導致分數膨脹
- 不如方案 1 直觀

---

### 方案 3：減少加分項，增加扣分項（推薦）

#### 出場質量調整

**當前**：
- 優秀收益（≥ 20%）+20
- 良好收益（≥ 10%）+10
- 不錯收益（≥ 5%）+5

**調整為**：
- 優秀收益（≥ 20%）+10
- 良好收益（≥ 10%）+5
- 不錯收益（≥ 5%）+0（不加分，這是應該的）

**增加扣分項**：
- 出場過早（有更大獲利空間）-10
- 出場過晚（回撤過大）-10

#### 紀律遵守調整

**當前**：
- 自動平倉 +15
- 持倉合理 +5

**調整為**：
- 自動平倉 +10（減少）
- 持倉合理 +0（移除，這是應該的）

**增加扣分項**：
- 頻繁交易（1小時內多筆）-10
- 交易時間不當（凌晨交易）-5

---

### 方案 4：使用相對評分

**概念**：
- 不是絕對評分（0-100）
- 而是相對評分（與平均水平比較）

**實施**：
```python
# 計算所有交易的平均表現
avg_return = all_trades['actual_return'].mean()
avg_rr_ratio = all_trades['rr_ratio'].mean()

# 相對評分
if actual_return > avg_return * 1.5:
    exit_score += 15  # 顯著優於平均
elif actual_return > avg_return:
    exit_score += 5   # 優於平均
elif actual_return < avg_return * 0.5:
    exit_score -= 15  # 顯著劣於平均
```

**問題**：
- 需要歷史數據
- 較複雜

---

## 推薦實施方案

### 組合方案：方案 1 + 方案 3

#### 1. 降低初始分數
```python
entry_score = 70.0
exit_score = 70.0
risk_score = 70.0
discipline_score = 70.0
```

#### 2. 調整加分項
- 減少加分幅度（+20 → +10）
- 移除「應該做到」的加分項
- 只對「超出預期」的行為加分

#### 3. 增加扣分項
- 出場過早/過晚
- 頻繁交易
- 交易時間不當

#### 4. 新的評分等級
- 90-100：優秀（10%）
- 80-89：良好（20%）
- 70-79：及格（40%）
- 60-69：需改進（20%）
- < 60：不及格（10%）

---

## 具體修改建議

### 出場質量

**移除/減少的加分**：
```python
# 移除
# elif actual_return >= 5:
#     exit_score += 5  # 不錯收益

# 減少
if actual_return >= 20:
    exit_score += 10  # 從 +20 改為 +10
elif actual_return >= 10:
    exit_score += 5   # 從 +10 改為 +5
```

**增加的扣分**：
```python
# 出場過早（需要持倉過程數據）
if max_profit > actual_profit * 1.5:
    exit_score -= 10
    errors.append("出場過早，錯過更大獲利")

# 出場過晚（回撤過大）
if max_drawdown > actual_return * 0.3:
    exit_score -= 10
    errors.append("出場過晚，回撤過大")
```

### 紀律遵守

**移除的加分**：
```python
# 移除持倉時間合理的加分
# discipline_score += 5  # 這是應該的，不加分
```

**減少的加分**：
```python
# 自動平倉
discipline_score += 10  # 從 +15 改為 +10
```

**增加的扣分**：
```python
# 頻繁交易
if count_trades_in_last_hour() > 3:
    discipline_score -= 10
    errors.append("頻繁交易（1小時內>3筆）")

# 交易時間不當
if 0 <= entry_hour < 6:  # 凌晨交易
    discipline_score -= 5
    errors.append("凌晨交易，可能是情緒化")
```

---

## 預期效果

### 調整前（當前）
- 平均總分：85-90
- 大部分交易：80-100
- 很少 < 70

### 調整後（預期）
- 平均總分：70-75
- 分數分布：
  - 90-100：10%（真正優秀）
  - 80-89：20%（良好）
  - 70-79：40%（及格）
  - 60-69：20%（需改進）
  - < 60：10%（不及格）

---

## 更新日期
2026-02-06
