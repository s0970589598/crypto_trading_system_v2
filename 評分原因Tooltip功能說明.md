# 評分原因 Tooltip 功能說明

## 功能概述

現在評分明細支援滑鼠懸停顯示評分原因！

當你將滑鼠移到評分數字上時，會顯示該項評分的詳細原因。

---

## 使用方法

### 1. 查看交易評分

在「交易覆盤」頁面：
1. 選擇一筆交易
2. 展開「📊 評分明細」
3. 將滑鼠移到評分數字上（進場/出場/風險/紀律）
4. 會彈出 tooltip 顯示評分原因

---

## Tooltip 內容

### 進場質量 Tooltip

顯示與進場相關的評分原因：
- ✅ 多重信號確認
- ✅ 雙重信號確認
- ✅ 強勢突破布林上軌
- ❌ 逆勢做多/做空
- ❌ 震盪市交易
- ❌ RSI 超買/超賣時進場
- ❌ MACD 信號不利
- ❌ 高波動市場使用高槓桿
- ❌ 價格在布林帶極端位置

**範例**：
```
進場質量評分

評分原因：
• ✅ 多重信號確認（3+）
• ✅ 強勢突破布林上軌
```

---

### 出場質量 Tooltip

顯示與出場相關的評分原因：
- ✅ 優秀收益
- ✅ 良好收益
- ✅ 優秀盈虧比
- ✅ 良好盈虧比
- ✅ 嚴格止損
- ❌ 實際收益偏低
- ❌ 實際收益一般
- ❌ 實際虧損過大
- ❌ 實際虧損較大
- ❌ 盈虧比不佳
- ❌ 虧損超過預期風險

**範例**：
```
出場質量評分

評分原因：
• ✅ 優秀收益（25.50%）
• ✅ 優秀盈虧比（1:3.20）
```

---

### 風險控制 Tooltip

顯示與風險管理相關的評分原因：
- ✅ 保守槓桿（≤5x）
- ✅ 適中槓桿（≤10x）
- ✅ 手續費控制良好
- ❌ 槓桿極高（>100x）
- ❌ 槓桿過高（>50x）
- ❌ 槓桿偏高（>20x）
- ❌ 手續費佔盈虧比例過高

**範例**：
```
風險控制評分

評分原因：
• ✅ 保守槓桿（≤5x）
• ✅ 手續費控制良好（3.2%）
```

---

### 紀律遵守 Tooltip

顯示與交易紀律相關的評分原因：
- ✅ 遵守交易計劃（自動平倉）
- ❌ 爆倉
- ❌ 虧損快速手動平倉
- ❌ 虧損較快手動平倉
- ❌ 獲利太少即手動平倉
- ❌ 持倉時間極短（<6分鐘）

**範例**：
```
紀律遵守評分

評分原因：
• ✅ 遵守交易計劃（自動平倉）
```

---

## 技術實現

### 評分原因分類邏輯

系統會自動將評分原因分類到對應的評分項：

```python
# 進場相關關鍵字
['逆勢', '震盪', 'rsi', 'macd', '信號', '確認', '波動', '布林']

# 出場相關關鍵字
['收益', '虧損', '盈虧比', '止損']

# 風險相關關鍵字
['槓桿', '手續費']

# 紀律相關關鍵字
['爆倉', '平倉', '持倉', '交易計劃']
```

### 數據來源

評分原因存儲在 `quality_scores.json` 的 `tags` 字段中：

```json
{
  "trade_id": "xxx",
  "entry_score": 75,
  "exit_score": 80,
  "risk_score": 85,
  "discipline_score": 90,
  "tags": [
    "auto_scored",
    "✅ 多重信號確認（3+）",
    "✅ 優秀收益（25.50%）",
    "✅ 保守槓桿（≤5x）",
    "✅ 遵守交易計劃（自動平倉）"
  ]
}
```

---

## 優點

### 1. 快速查看
- 不需要展開完整註記
- 滑鼠懸停即可查看
- 節省空間

### 2. 分類清晰
- 每個評分項只顯示相關原因
- 不會混淆不同類別的原因
- 更容易理解

### 3. 即時反饋
- 立即知道為什麼得到這個分數
- 快速識別優點和缺點
- 方便改進

---

## 使用場景

### 場景 1：快速檢視
當你想快速了解某筆交易的評分原因時：
1. 滑鼠移到評分上
2. 查看 tooltip
3. 不需要展開完整註記

### 場景 2：對比分析
當你想對比多筆交易的評分原因時：
1. 依次查看每筆交易的 tooltip
2. 快速識別共同問題
3. 找出改進方向

### 場景 3：學習改進
當你想學習如何提高評分時：
1. 查看高分交易的 tooltip（看優點）
2. 查看低分交易的 tooltip（看缺點）
3. 總結經驗教訓

---

## 注意事項

### 1. 自動評分才有詳細原因
- 手動評分的交易可能沒有詳細的評分原因
- 建議使用自動評分功能

### 2. 評分原因會自動分類
- 系統會根據關鍵字自動分類
- 如果分類不準確，原因會歸類到「紀律」項

### 3. Tooltip 顯示位置
- Streamlit 的 tooltip 會自動調整位置
- 確保不會被遮擋

---

## 範例展示

### 優秀交易（90+ 分）

**進場質量（23/25）**
```
進場質量評分

評分原因：
• ✅ 多重信號確認（3+）
• ✅ 強勢突破布林上軌
```

**出場質量（24/25）**
```
出場質量評分

評分原因：
• ✅ 優秀收益（25.50%）
• ✅ 優秀盈虧比（1:3.20）
```

**風險控制（23/25）**
```
風險控制評分

評分原因：
• ✅ 保守槓桿（≤5x）
• ✅ 手續費控制良好（3.2%）
```

**紀律遵守（24/25）**
```
紀律遵守評分

評分原因：
• ✅ 遵守交易計劃（自動平倉）
```

---

### 需改進交易（60- 分）

**進場質量（15/25）**
```
進場質量評分

評分原因：
• ❌ 逆勢做多（市場downtrend）
• ❌ RSI超買時做多（RSI=75.3）
```

**出場質量（12/25）**
```
出場質量評分

評分原因：
• ❌ 實際虧損較大（-8.50%）
• ❌ 盈虧比不佳（1:0.8，日內建議>1.5）
```

**風險控制（15/25）**
```
風險控制評分

評分原因：
• ❌ 槓桿偏高（>20x）
• ❌ 手續費佔盈虧35.2%，偏高
```

**紀律遵守（18/25）**
```
紀律遵守評分

評分原因：
• ❌ 虧損快速手動平倉，可能是情緒化交易
```

---

## 更新日期
2026-02-06

## 版本
v2.1.1
