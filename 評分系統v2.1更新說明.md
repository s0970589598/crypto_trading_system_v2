# 評分系統 v2.1 更新說明

## 更新日期
2026-02-06

## 更新版本
v2.0 → v2.1.1

---

## 主要改進

### 🎯 核心問題解決

#### 問題 1：評分普遍偏高
- **原因**：初始分數 100 分，默認所有交易都是完美的
- **解決**：降低初始分數至 70 分（及格分）

#### 問題 2：持倉時間加分不合理
- **原因**：持倉時間本身不代表交易品質
- **解決**：移除所有持倉時間加分，只在極端情況（< 6分鐘）扣分

#### 問題 3：加分項太多太容易
- **原因**：太多「應該做到」的事情都給加分
- **解決**：減少加分幅度，移除基本要求的加分

#### 問題 4：評分原因不易查看（新增）
- **原因**：需要展開完整註記才能看到評分原因
- **解決**：添加 tooltip 功能，滑鼠懸停即可查看評分原因

---

## 具體修改內容

### 1. 初始分數調整 ⭐⭐⭐

**修改前**：
```python
entry_score = 100.0
exit_score = 100.0
risk_score = 100.0
discipline_score = 100.0
```

**修改後**：
```python
entry_score = 70.0  # 及格分
exit_score = 70.0
risk_score = 70.0
discipline_score = 70.0
```

**影響**：
- 普通交易：70 分（及格）
- 需要做對事情才能加分到 80-90
- 做錯事情會扣分到 60 以下

---

### 2. 持倉時間評分調整 ⭐⭐⭐

**修改前**：
```python
entry_score = 100.0
exit_score = 100.0
risk_score = 100.0
discipline_score = 100.0
```

**修改後**：
```python
entry_score = 70.0  # 及格分
exit_score = 70.0
risk_score = 70.0
discipline_score = 70.0
```

**影響**：
- 普通交易：70 分（及格）
- 需要做對事情才能加分到 80-90
- 做錯事情會扣分到 60 以下

---

### 2. 持倉時間評分調整 ⭐⭐⭐

**修改前**：
```python
# 根據交易風格給持倉時間加分
if trading_style == 'scalping':
    if 0.1 <= holding_hours <= 1:
        discipline_score += 5  # 加分
elif trading_style == 'day_trading':
    if 1 <= holding_hours <= 4:
        discipline_score += 5  # 加分
# ... 更多加分邏輯
```

**修改後**：
```python
# 只在極端情況扣分
if holding_hours < 0.1:  # < 6 分鐘
    errors.append("持倉時間極短（<6分鐘），可能是衝動交易")
    discipline_score -= 10
```

**影響**：
- 移除所有持倉時間加分
- 只懲罰極短時間交易（< 6分鐘）
- 持倉時間不再影響大部分交易的評分

---

### 3. 出場質量加分調整 ⭐⭐⭐

**修改前**：
```python
if actual_return >= 20:
    exit_score += 20  # 優秀收益
elif actual_return >= 10:
    exit_score += 10  # 良好收益
elif actual_return >= 5:
    exit_score += 5   # 不錯收益
```

**修改後**：
```python
if actual_return >= 20:
    exit_score += 10  # 優秀收益（減半）
elif actual_return >= 10:
    exit_score += 5   # 良好收益（減半）
# 移除 >= 5% 的加分（這是應該做到的）
```

**影響**：
- 加分幅度減半
- 移除基本收益的加分
- 只對真正優秀的表現加分

---

### 4. 盈虧比加分調整 ⭐⭐

**修改前**：
```python
if risk_reward_ratio >= min_rr_ratio * 1.5:
    exit_score += 10  # 優秀盈虧比
elif risk_reward_ratio >= min_rr_ratio:
    exit_score += 5   # 良好盈虧比
```

**修改後**：
```python
if risk_reward_ratio >= min_rr_ratio * 1.5:
    exit_score += 5   # 優秀盈虧比（減半）
elif risk_reward_ratio >= min_rr_ratio:
    # 不加分（這是應該做到的）
    errors.append(f"✅ 良好盈虧比（1:{risk_reward_ratio:.2f}）")
```

**影響**：
- 優秀盈虧比加分減半
- 達到基本要求不加分
- 只對超出預期的表現加分

---

### 5. 止損執行加分調整 ⭐⭐

**修改前**：
```python
if actual_loss_price <= risk_amount:
    exit_score += 10  # 嚴格止損
```

**修改後**：
```python
if actual_loss_price <= risk_amount:
    exit_score += 5   # 嚴格止損（減半）
```

**影響**：
- 加分幅度減半
- 嚴格止損仍然獲得獎勵，但更合理

---

### 6. 自動平倉加分調整 ⭐⭐

**修改前**：
```python
if trade['close_type'] in ['止損', '止盈', '自動平倉']:
    discipline_score += 15
```

**修改後**：
```python
if trade['close_type'] in ['止損', '止盈', '自動平倉']:
    discipline_score += 10  # 減少加分
```

**影響**：
- 加分從 15 降至 10
- 仍然鼓勵自動平倉，但更合理

---

### 7. 多重信號確認加分調整 ⭐⭐

**修改前**：
```python
if confirmations >= 3:
    entry_score += 15  # 多重確認
elif confirmations == 2:
    entry_score += 10  # 雙重確認
elif confirmations == 1:
    entry_score += 5   # 單一確認
```

**修改後**：
```python
if confirmations >= 3:
    entry_score += 10  # 多重確認（減少）
elif confirmations == 2:
    entry_score += 5   # 雙重確認（減少）
# 移除單一確認的加分
```

**影響**：
- 加分幅度減少
- 移除單一確認加分
- 只對多重確認給予獎勵

---

### 8. 評分原因 Tooltip 功能 ⭐⭐⭐ (新增)

**功能**：
- 滑鼠懸停在評分數字上時顯示評分原因
- 自動分類評分原因到對應的評分項
- 快速查看，不需要展開完整註記

**實現**：
```python
# 進場質量 tooltip
entry_help = "進場質量評分\n\n"
if entry_reasons:
    entry_help += "評分原因：\n" + "\n".join(f"• {r}" for r in entry_reasons)
else:
    entry_help += "無特別註記"

st.metric("進場", f"{entry_score:.0f}/25", help=entry_help)
```

**影響**：
- 更容易理解評分原因
- 快速識別優點和缺點
- 提升用戶體驗

---

## 評分等級變化

### 修改前（v2.0）
| 總分 | 等級 | 實際佔比 |
|------|------|----------|
| 90-100 | 優秀 | 40% |
| 80-89 | 良好 | 35% |
| 70-79 | 及格 | 20% |
| 60-69 | 需改進 | 4% |
| < 60 | 不及格 | 1% |

**問題**：
- 大部分交易 80-100 分
- 難以區分好壞交易
- 缺乏改進動力

### 修改後（v2.1）
| 總分 | 等級 | 預期佔比 |
|------|------|----------|
| 90-100 | 優秀 | 10% |
| 80-89 | 良好 | 20% |
| 70-79 | 及格 | 40% |
| 60-69 | 需改進 | 20% |
| < 60 | 不及格 | 10% |

**改進**：
- 正態分布，更合理
- 清晰區分優秀/良好/及格/不及格
- 有明確的改進空間和方向

---

## 預期效果

### 評分分布
- **調整前**：平均 85-90 分，大部分 80-100
- **調整後**：平均 70-75 分，正態分布

### 區分度
- **調整前**：難以區分好壞交易
- **調整後**：清晰區分優秀/良好/及格/不及格

### 激勵效果
- **調整前**：大部分交易都高分，缺乏改進動力
- **調整後**：有明確的改進空間和方向

---

## 評分標準說明

### 90-100 分（優秀）
- 多個優點，無明顯缺點
- 市場環境分析正確（多重信號確認）
- 收益率優秀（≥ 20%）
- 盈虧比優秀（≥ 1.5倍建議值）
- 風險控制良好（保守槓桿、嚴格止損）
- 紀律嚴格（自動平倉）

### 80-89 分（良好）
- 有優點，缺點較少
- 市場環境分析基本正確
- 收益率良好（≥ 10%）
- 盈虧比達標
- 風險控制合理
- 紀律良好

### 70-79 分（及格）
- 普通交易，無明顯優缺點
- 市場環境分析一般
- 收益率一般
- 盈虧比一般
- 風險控制一般
- 紀律一般

### 60-69 分（需改進）
- 有明顯缺點
- 市場環境分析錯誤（逆勢、指標不利）
- 收益率偏低或虧損較大
- 盈虧比不佳
- 風險控制不足（高槓桿、止損不及時）
- 紀律不佳（手動平倉、頻繁交易）

### < 60 分（不及格）
- 嚴重問題
- 爆倉
- 嚴重逆勢
- 虧損過大
- 極高槓桿
- 嚴重違反紀律

---

## 使用建議

### 1. 重新評分
建議對現有交易重新評分，以獲得更準確的評估：
```bash
# 在 Web 界面中
1. 進入「交易覆盤」頁面
2. 選擇要重新評分的交易
3. 點擊「自動評分」按鈕
```

### 2. 觀察變化
- 觀察評分分布是否更合理
- 檢查是否能清晰區分好壞交易
- 確認評分是否符合實際交易品質

### 3. 持續改進
- 根據評分結果找出弱點
- 針對性改進交易策略
- 定期檢視評分趨勢

---

## 後續計劃

### 第二階段（近期）
1. ⏳ 添加進場價格品質評估
2. ⏳ 添加頻繁交易檢測

### 第三階段（未來）
3. 📋 添加持倉過程品質評估（最大浮虧/浮盈）
4. 📋 添加倉位管理評估
5. 📋 添加止損設置評估

---

## 技術細節

### 修改文件
- `web_dashboard_v2.py`（評分邏輯 + UI 顯示）

### 修改行數
- 評分邏輯：約 6 處修改（~50 行代碼）
- Tooltip 功能：1 處修改（~70 行代碼）

### 向後兼容性
- ✅ 完全向後兼容
- ✅ 不影響現有數據
- ✅ 可以重新評分

### 新增功能
- ✅ 評分原因 Tooltip
- ✅ 自動分類評分原因
- ✅ 智能關鍵字匹配

---

## 使用說明

### 查看評分原因

1. **啟動 Web 界面**
   ```bash
   ./啟動Web界面v2.sh
   ```

2. **進入交易覆盤頁面**
   - 選擇一筆交易
   - 展開「📊 評分明細」

3. **查看 Tooltip**
   - 將滑鼠移到評分數字上
   - 會顯示該項評分的詳細原因

### Tooltip 內容範例

**進場質量（23/25）**
```
進場質量評分

評分原因：
• ✅ 多重信號確認（3+）
• ✅ 強勢突破布林上軌
```

**出場質量（24/25）**
```
出場質量評分

評分原因：
• ✅ 優秀收益（25.50%）
• ✅ 優秀盈虧比（1:3.20）
```

詳細說明請參考：`評分原因Tooltip功能說明.md`

---

## 總結

這次更新（v2.1.1）主要解決了評分偏高的問題，並新增了評分原因 Tooltip 功能：

**核心改進**：
1. 降低初始分數（100 → 70）
2. 移除持倉時間加分
3. 減少加分幅度
4. 新增評分原因 Tooltip（滑鼠懸停顯示）

**預期效果**：
- 評分分布更合理（正態分布）
- 清晰區分交易品質
- 提供明確的改進方向
- 更容易查看評分原因

**建議**：
- 立即重新評分所有交易，以獲得更準確的評估
- 使用 Tooltip 功能快速查看評分原因
- 根據評分原因針對性改進交易策略
