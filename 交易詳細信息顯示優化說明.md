# 交易詳細信息顯示優化說明

## 更新內容

在「交易覆盤」頁面的交易詳細信息中，新增了以下信息：
- ✅ 交易數量（Quantity）
- ✅ 槓桿倍數（Leverage）
- ✅ 盈虧百分比（PNL %）

---

## 顯示佈局

### 優化前（5列單行）
```
┌─────────┬─────┬──────┬──────┬──────────┐
│ 交易對  │ 方向│ 盈虧 │ 總分 │ 評分方式 │
└─────────┴─────┴──────┴──────┴──────────┘
```

### 優化後（4列雙行）
```
第一行：
┌─────────┬─────┬──────┬──────┐
│ 交易對  │ 方向│ 數量 │ 槓桿 │
└─────────┴─────┴──────┴──────┘

第二行：
┌──────────┬────────┬──────┬──────────┐
│ 盈虧(USDT)│ 盈虧(%)│ 總分 │ 評分方式 │
└──────────┴────────┴──────┴──────────┘
```

---

## 新增字段說明

### 1. 交易數量（Quantity）

**顯示格式**：`0.1234`（保留4位小數）

**說明**：
- 顯示實際交易的數量
- 對於 BTC 通常是小數（如 0.05 BTC）
- 對於其他幣種可能是整數或小數

**範例**：
- BTC：`0.0500`
- ETH：`1.2500`
- SOL：`10.0000`

**特殊情況**：
- 如果數據中沒有數量信息，顯示 `N/A`

---

### 2. 槓桿倍數（Leverage）

**顯示格式**：`20x`（整數 + x）

**說明**：
- 顯示使用的槓桿倍數
- 影響實際收益率和風險

**範例**：
- 低槓桿：`5x`
- 中槓桿：`20x`
- 高槓桿：`50x`
- 極高槓桿：`100x`

**特殊情況**：
- 如果數據中沒有槓桿信息，顯示 `N/A`
- 現貨交易槓桿為 `1x`

---

### 3. 盈虧百分比（PNL %）

**顯示格式**：`+2.50%` 或 `-1.20%`

**計算方式**：
```python
# 做多
pnl_pct = ((exit_price - entry_price) / entry_price) * 100

# 做空
pnl_pct = ((entry_price - exit_price) / entry_price) * 100
```

**說明**：
- 顯示價格變動的百分比
- 不考慮槓桿（實際收益率 = 盈虧% × 槓桿）
- 正數表示獲利，負數表示虧損

**範例**：
- 獲利：`+2.50%`（使用20x槓桿，實際收益 = 50%）
- 虧損：`-1.20%`（使用20x槓桿，實際虧損 = -24%）

**特殊情況**：
- 如果沒有進場/出場價格，顯示 `N/A`

---

## 完整範例

### 範例 1：獲利交易

```
第一行：
┌──────────┬──────┬─────────┬──────┐
│ BTCUSDT  │ Long │ 0.0500  │ 20x  │
└──────────┴──────┴─────────┴──────┘

第二行：
┌────────────┬─────────┬──────┬──────────┐
│ +125.50 USDT│ +2.50% │ 85/100│ 🤖 自動 │
└────────────┴─────────┴──────┴──────────┘
```

**解讀**：
- 交易對：BTCUSDT
- 方向：做多（Long）
- 數量：0.05 BTC
- 槓桿：20倍
- 盈虧：+125.50 USDT
- 價格變動：+2.50%
- 實際收益率：2.50% × 20 = 50%
- 評分：85分（良好）
- 評分方式：自動評分

---

### 範例 2：虧損交易

```
第一行：
┌──────────┬───────┬─────────┬──────┐
│ ETHUSDT  │ Short │ 1.2500  │ 50x  │
└──────────┴───────┴─────────┴──────┘

第二行：
┌────────────┬─────────┬──────┬──────────┐
│ -85.20 USDT│ -1.80% │ 62/100│ 🤖 自動 │
└────────────┴─────────┴──────┴──────────┘
```

**解讀**：
- 交易對：ETHUSDT
- 方向：做空（Short）
- 數量：1.25 ETH
- 槓桿：50倍
- 盈虧：-85.20 USDT
- 價格變動：-1.80%（做空時價格上漲）
- 實際虧損率：1.80% × 50 = 90%
- 評分：62分（需改進）
- 評分方式：自動評分

---

## 優點

### 1. 信息更完整
- 一眼看到所有關鍵信息
- 不需要展開其他區域
- 方便快速評估交易

### 2. 佈局更合理
- 雙行佈局，每行4列
- 相關信息分組顯示
- 視覺上更清晰

### 3. 計算更準確
- 盈虧百分比自動計算
- 考慮做多/做空方向
- 顯示實際價格變動

---

## 使用場景

### 場景 1：評估倉位大小
查看「數量」和「槓桿」，了解實際風險暴露：
- 數量 × 價格 × 槓桿 = 實際倉位價值

### 場景 2：分析收益率
對比「盈虧(USDT)」和「盈虧(%)」：
- 盈虧% 顯示價格變動
- 實際收益率 = 盈虧% × 槓桿

### 場景 3：風險管理
檢查槓桿使用是否合理：
- 高波動 + 高槓桿 = 高風險
- 評分系統會自動評估

---

## 技術細節

### 數據來源

```python
# 從交易記錄中獲取
quantity = selected_row.get('quantity', 0)
leverage = selected_row.get('leverage', 1)
entry_price = selected_row.get('entry_price', 0)
exit_price = selected_row.get('exit_price', 0)
```

### 盈虧百分比計算

```python
if selected_row['direction'] == 'Long':
    # 做多：出場價 > 進場價 = 獲利
    pnl_pct = ((exit_price - entry_price) / entry_price) * 100
else:
    # 做空：進場價 > 出場價 = 獲利
    pnl_pct = ((entry_price - exit_price) / entry_price) * 100
```

### 格式化

```python
# 數量：保留4位小數
f"{quantity:.4f}"

# 槓桿：整數 + x
f"{leverage:.0f}x"

# 盈虧百分比：帶符號，保留2位小數
f"{pnl_pct:+.2f}%"
```

---

## 注意事項

### 1. 數據完整性
- 確保交易記錄中有 `quantity` 和 `leverage` 字段
- 如果沒有，會顯示 `N/A`

### 2. 盈虧百分比 vs 實際收益率
- **盈虧百分比**：價格變動百分比（不考慮槓桿）
- **實際收益率**：盈虧百分比 × 槓桿

### 3. 槓桿影響
- 槓桿放大收益，也放大虧損
- 評分系統會根據槓桿調整評分

---

## 相關文檔

- `評分系統v2.1更新說明.md` - 評分系統說明
- `K線圖價格顯示修正說明.md` - K線圖價格顯示
- `評分原因Tooltip功能說明.md` - 評分原因查看

---

## 更新日期
2026-02-06

## 版本
v2.1.3
