# 評分系統改進建議

## 當前問題

根據對現有評分邏輯的分析，發現以下主要問題：

1. ❌ **重複扣分**：同一問題在多個維度重複扣分
2. ❌ **忽略槓桿影響**：沒有將盈虧百分比調整為實際收益
3. ❌ **忽略交易風格**：短線和長線使用相同標準
4. ❌ **指標理解偏差**：某些技術指標的解讀不夠準確
5. ❌ **缺少正面激勵**：大部分都是扣分，很少加分

---

## 改進方案

### 1. 移除重複扣分

**問題**：槓桿在進場和風險管理中都扣分

**建議**：
- 進場評分：只評估槓桿與市場環境的匹配（高波動 + 高槓桿）
- 風險管理：評估槓桿與倉位大小的合理性

**問題**：虧損幅度在出場和風險管理中都扣分

**建議**：
- 出場評分：評估是否及時止損（與預期風險比較）
- 風險管理：評估止損設置是否合理（與 ATR 比較）

---

### 2. 考慮槓桿調整

**當前邏輯**：
```python
if pnl_pct < 0.5:
    exit_score -= 25  # 獲利太少
```

**問題**：
- 10x 槓桿下 0.5% = 5% 實際收益（很好）
- 1x 槓桿下 0.5% = 0.5% 實際收益（確實少）

**改進建議**：
```python
# 計算實際收益率
actual_return = pnl_pct * leverage

# 根據實際收益率評分
if actual_return < 2:  # 實際收益 < 2%
    exit_score -= 25
elif actual_return < 5:  # 實際收益 < 5%
    exit_score -= 15
elif actual_return >= 10:  # 實際收益 >= 10%
    exit_score += 10  # 加分
```

---

### 3. 根據交易風格調整標準

**識別交易風格**：
```python
# 根據持倉時間判斷交易風格
if holding_hours < 1:
    style = 'scalping'  # 超短線
elif holding_hours < 4:
    style = 'day_trading'  # 日內交易
elif holding_hours < 24:
    style = 'swing'  # 短線波段
else:
    style = 'position'  # 中長線
```

**不同風格的評分標準**：

| 標準 | 超短線 | 日內 | 短線 | 中長線 |
|------|--------|------|------|--------|
| 最小獲利 | 0.2% | 0.5% | 1% | 2% |
| 最大虧損 | 0.5% | 1% | 2% | 3% |
| 盈虧比要求 | 1:1 | 1.5:1 | 2:1 | 3:1 |

---

### 4. 優化技術指標評估

#### RSI 超買超賣

**當前邏輯**：
- 做多時 RSI > 70 → 扣 20 分

**問題**：
- 強上漲趨勢中，RSI 可能長期 > 70
- 這時做多可能是正確的

**改進建議**：
```python
# 結合趨勢判斷
if direction == 'Long' and rsi_state == 'overbought':
    if trend in ['strong_uptrend', 'uptrend']:
        # 強趨勢中的超買是正常的
        entry_score -= 5  # 輕微扣分
    else:
        # 非上漲趨勢中的超買是危險的
        entry_score -= 20
```

#### 布林帶位置

**當前邏輯**：
- 做多在上軌之上 → 扣 10 分

**問題**：
- 突破上軌可能是強勢信號（布林帶突破策略）

**改進建議**：
```python
# 結合趨勢和成交量
if direction == 'Long' and bb_position == 'above_upper':
    if trend in ['strong_uptrend'] and volume_state == 'high':
        # 強勢突破，加分
        entry_score += 5
    else:
        # 可能超買
        entry_score -= 10
```

---

### 5. 增加正面激勵

**當前問題**：只有 3 個加分項
- 順勢交易 +5
- 盈虧比 ≥ 3 +10
- 盈虧比 ≥ 2 +5

**建議增加**：

#### 進場質量加分
```python
# 多個指標確認
confirmations = 0
if trend_matches: confirmations += 1
if macd_matches: confirmations += 1
if rsi_matches: confirmations += 1

if confirmations >= 3:
    entry_score += 15  # 多重確認
elif confirmations == 2:
    entry_score += 10
```

#### 出場質量加分
```python
# 優秀的實際收益
if actual_return >= 20:
    exit_score += 20
elif actual_return >= 10:
    exit_score += 10
elif actual_return >= 5:
    exit_score += 5
```

#### 風險管理加分
```python
# 合理的槓桿使用
if leverage <= 5:
    risk_score += 10  # 保守槓桿
elif leverage <= 10:
    risk_score += 5  # 適中槓桿

# 嚴格的止損執行
if trade['pnl'] < 0:
    if abs(actual_loss) <= expected_risk:
        risk_score += 10  # 嚴格止損
```

#### 紀律遵守加分
```python
# 自動止損/止盈
if trade['close_type'] in ['止損', '止盈']:
    discipline_score += 15  # 遵守計劃

# 合理的持倉時間
if 1 <= holding_hours <= 24:
    discipline_score += 5  # 不過度交易
```

---

## 建議的新評分公式

### 進場質量（Entry Score）
```
基礎分 100
- 槓桿與波動率不匹配：-15
- 逆勢交易：-25
- 指標不確認：-10 × 不確認數量
+ 多重確認：+10 ~ +15
+ 順勢交易：+5
```

### 出場質量（Exit Score）
```
基礎分 100
- 實際收益不足：-15 ~ -25（根據交易風格）
- 止損過晚：-15 ~ -35（根據超出預期風險的程度）
+ 優秀收益：+5 ~ +20（根據實際收益率）
+ 優秀盈虧比：+5 ~ +10
```

### 風險管理（Risk Score）
```
基礎分 100
- 槓桿過高：-10 ~ -40（根據倉位大小）
- 手續費過高：-10 ~ -15
+ 保守槓桿：+5 ~ +10
+ 嚴格止損：+10
```

### 紀律遵守（Discipline Score）
```
基礎分 100
- 爆倉：= 0
- 情緒化交易：-15 ~ -30
- 過度交易：-10 ~ -15
+ 自動止損/止盈：+15
+ 合理持倉時間：+5
```

---

## 實施優先級

### 高優先級（立即實施）
1. ✅ 移除重複扣分
2. ✅ 考慮槓桿調整（實際收益率）
3. ✅ 增加正面激勵

### 中優先級（近期實施）
4. ⏳ 根據交易風格調整標準
5. ⏳ 優化技術指標評估

### 低優先級（長期優化）
6. 📋 機器學習優化權重
7. 📋 個性化評分標準

---

## 測試建議

改進後應該測試：
1. 同一筆交易的評分是否更合理
2. 好交易的分數是否提高
3. 壞交易的分數是否降低
4. 不同交易風格是否得到公平評分

---

## 更新日期
2026-02-06
