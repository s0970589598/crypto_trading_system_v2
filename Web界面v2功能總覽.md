# Web Dashboard v2 功能總覽

## 🎯 主要功能

### 1. BingX 交易分析 💰

#### 基本統計
- 總訂單數、獲利/虧損訂單數
- 勝率計算
- 總盈虧、總手續費、淨收益

#### 損益分析
- 獲利訂單：數量、平均獲利、最大獲利
- 虧損訂單：數量、平均虧損、最大虧損
- 績效指標：盈虧比、獲利因子

#### 交易習慣分析
- 平均持倉時間
- 平均槓桿倍數
- 盈虧比和獲利因子

#### 按方向分析
- 做多/做空分佈
- 各方向的盈虧統計

#### 按平倉類型分析
- 手動平倉、止盈止損、爆倉等
- 各類型的盈虧分佈

#### 按交易對分析
- 各交易對的訂單數、勝率、總盈虧

#### 時間分析
- 每日交易數量折線圖
- 每日盈虧柱狀圖
- 按小時分析（各時段盈虧分佈）
- 每日詳細數據表格

#### 📊 每日交易頻率分析（新增）
- 平均每日訂單數
- 最多一天訂單數
- 交易天數統計
- 交易頻率評估（過度交易警告）

#### 💹 投資回報率（ROI）（新增）
- 基於平均倉位的 ROI 估算
- 手動輸入初始資金計算準確 ROI
- 未扣手續費 ROI
- 淨 ROI（扣除手續費）

#### 💸 手續費詳細分析（新增）
- 總手續費、平均每筆手續費
- 手續費佔盈虧比例
- 實際手續費率計算
- 按帳戶類型分析手續費
- **手續費優化建議**：
  - 手續費比例評估
  - 每日平均手續費
  - 減少交易頻率的潛在節省

#### 綜合分析與建議
- 問題診斷（勝率、盈虧、手續費、持倉時間、槓桿）
- 具體改進建議

#### 📋 查看訂單詳細記錄
- 篩選功能：按帳戶類型、方向、盈虧
- 顯示欄位：
  - 開倉時間、平倉時間
  - 帳戶類型、交易對、方向
  - 進場價、出場價、數量
  - 槓桿、盈虧、手續費
  - 平倉類型

---

### 2. 交易記錄管理 📝

#### 上傳功能
- 支持 Excel 和 CSV 格式
- 自動識別帳戶類型（Standard_Futures、USDⓢ_M_Perpetual_Futures）
- 多工作表支持

#### 數據處理
- 自動統一欄位名稱
- 提取交易方向（Long/Short）
- 標記動作類型（Open/Close）

#### Perpetual 帳戶智能配對
- **按 symbol + direction + leverage 配對**
- **評分系統**：
  - 槓桿相同：+100 分
  - 時間越近：+0~50 分
- **處理加倉換倍數**：自動標記
- **補充信息**：
  - 從 Open 記錄獲取進場價和進場時間
  - 從 Close 記錄獲取出場價和 PNL

#### 去重機制
- 使用 Order No 作為唯一標識
- 支持三種處理方式：
  - 跳過重複（推薦）
  - 更新重複
  - 保留所有

#### 數據保存
- 按日期分組保存（YYYY/MM/YYYYMMDD.json）
- 標準化 JSON 格式
- 自動維護索引文件

#### 查看已保存記錄
- 按年月查看
- 顯示訂單數量和時間範圍

---

### 3. 執行質量評分 ⭐（完全整合）

#### 選擇交易評分
- 顯示最近 20/50/100/200 筆或全部交易
- **全選功能**：一鍵選擇所有交易
- 支持多選評分
- 勾選框選擇要評分的交易
- 支持按方向、盈虧篩選

#### 顯示欄位
- 開倉時間、平倉時間
- 交易對、方向
- 槓桿
- 進場價、出場價
- 盈虧、手續費
- 平倉類型

#### 評分方式
**手動評分**：
- 4 個評分維度（0-100 分）：
  - **進場質量**：進場時機、價格、信號確認
  - **出場質量**：出場時機、目標達成、止損執行
  - **風險管理**：倉位大小、止損設置、槓桿使用
  - **紀律遵守**：交易計劃遵守、情緒控制
- 添加文字註記
- 支持標籤分類

**自動評分**（智能分析）：
系統根據實際數據和指標自動計算評分：

1. **進場質量評分**：
   - 槓桿合理性（>100x/-30分，>50x/-20分，>20x/-10分）
   
2. **出場質量評分**：
   - 獲利交易：
     - 獲利太少（<0.5%/-25分，<1%/-15分）
     - 持倉時間過短（<30分鐘/-10分）
   - 虧損交易：
     - 虧損過大（>5%/-35分，>3%/-25分，>2%/-15分）
     - 虧損手動平倉（未執行止損計劃/-15~20分）
     - 恐慌性出場（<1小時/-20分）
   
3. **風險管理評分**：
   - 槓桿風險（>100x/-40分，>50x/-30分，>20x/-20分，>10x/-10分）
   - 止損設置（虧損>10%/-40分，>5%/-25分）
   - 手續費佔比（>50%/-15分，>30%/-10分）
   
4. **紀律遵守評分**：
   - 爆倉（0分，嚴重違規）
   - 虧損手動平倉（未遵守計劃/-20~30分）
   - 獲利太少即平倉（缺乏耐心/-15分）
   - 持倉時間異常（>48小時/-10分，<6分鐘/-15分）

- 自動生成詳細註記（包含持倉時間、盈虧百分比、問題列表）
- 自動添加問題標籤
- 一鍵批量評分

#### 評分統計
- 已評分交易數量
- 平均總分、進場分、出場分
- 評分方式統計（手動/自動）
- 評分趨勢圖
- 詳細評分列表

#### 數據保存
- 自動保存到 `data/review_history/quality_scores.json`
- 包含交易信息、評分、註記、標籤、評分方式
- 支持增量添加
- 兼容舊數據格式

### 4. 虧損分析 📉（新增）

#### 虧損原因分類
自動分析虧損交易並分類：
- **止損太緊**：持倉時間短且觸發止損
- **趨勢判斷錯誤**：止損但持倉時間較長
- **過早進場**：手動平倉且持倉時間很短
- **市場反轉**：手動平倉且持倉時間適中
- **持倉時間過長**：手動平倉且持倉超過 24 小時
- **風險管理不當**：爆倉
- **其他原因**：無法明確分類

#### 統計分析
- 各虧損原因的次數、總虧損、平均虧損
- 虧損原因佔比（按次數和金額）
- 可視化圖表（餅圖）

#### 詳細分析
- 選擇特定虧損原因查看詳情
- 顯示該原因的所有交易
- 平均持倉時間、平均虧損等指標

#### 改進建議
針對每種虧損原因提供具體的改進建議：
- 止損太緊 → 放寬止損距離、使用移動止損
- 趨勢判斷錯誤 → 加強趨勢確認、多週期分析
- 過早進場 → 等待更明確信號、回調進場
- 市場反轉 → 注意反轉信號、關鍵位置警惕
- 持倉時間過長 → 設置時間止損、定期檢查
- 風險管理不當 → 降低槓桿、嚴格止損
- 其他原因 → 詳細記錄、回顧計劃

#### 虧損趨勢分析
- 每日虧損金額和次數趨勢圖
- 識別虧損集中的時間段

#### 虧損改善行動計劃
- 自動識別最嚴重的虧損原因（前3名）
- 按虧損金額排序
- 提供優先改善項目和行動計劃

---

## 🚀 啟動方式

```bash
./啟動Web界面v2.sh
```

或

```bash
streamlit run web_dashboard_v2.py --server.port 8502
```

訪問：http://localhost:8502

---

## 📊 數據格式

### BingX Order History 支持格式

#### Standard_Futures
- Order No
- openTime(UTC+8)
- closeTime(UTC+8)
- category (交易對)
- direction (方向)
- openPrice (進場價)
- closePrice (出場價)
- quantity (數量)
- leverage (槓桿)
- Realized PNL (已實現盈虧)
- fees (手續費)
- closeType (平倉類型)

#### USDⓢ_M_Perpetual_Futures
- Order No.
- Time(UTC+8)
- Pair (交易對)
- Type (Open Long, Close Long, Open Short, Close Short)
- DealPrice (成交價)
- Quantity (數量)
- Leverage (槓桿)
- Realized PNL (已實現盈虧)
- Fee (手續費)

---

## 💡 使用建議

1. **定期上傳交易記錄**：建議每週上傳一次
2. **關注手續費比例**：應低於盈虧的 30%
3. **控制交易頻率**：每天 3-5 筆為佳
4. **使用 ROI 追蹤績效**：輸入初始資金獲得準確 ROI
5. **查看訂單詳細記錄**：分析具體交易，找出問題
6. **執行質量評分**：定期為交易評分，追蹤改善
7. **虧損分析**：重點分析虧損原因，制定改善計劃
8. **參考優化建議**：根據系統建議調整交易策略

---

## 📚 保留的核心文檔

- **Web界面v2功能總覽.md**（本文件）- 完整功能說明
- **完整功能與指令手冊.md** - CLI 和系統功能手冊
- **專案總覽與使用指南.md** - 項目整體介紹
- **快速開始.md** - 快速入門指南
- **新手入門教學.md** - 新手教學
- **文件導覽.md** - 文檔導航
- **BingX手續費完整說明.md** - 手續費說明
- **BingX不同帳戶手續費對比.md** - 帳戶對比

其他重複和過時的文檔已刪除。

---

## 🔧 技術特性

- **智能配對算法**：自動配對 Perpetual 的 Open 和 Close
- **多帳戶支持**：同時分析多個帳戶類型
- **增量更新**：支持增量上傳，不會重複記錄
- **數據持久化**：JSON 格式保存，易於備份和遷移
- **實時分析**：上傳後立即生成分析報告

---

## 📝 更新日誌

### v2.7 (2026-02-05) - 市場數據整合
- ✅ **整合市場數據分析到自動評分系統**
- ✅ 自動更新市場數據（檢測過期並從 Binance 獲取新數據）
- ✅ 計算多個技術指標：
  - 移動平均線（SMA 7/25/99，EMA 12/26）
  - MACD（含信號線和柱狀圖）
  - RSI（14週期）
  - ATR（波動率）
  - 布林帶
  - 成交量比率
- ✅ 分析進場時的市場環境：
  - 趨勢方向（強上升/上升/震盪/下降/強下降）
  - 趨勢強度（0-100）
  - RSI 狀態（超買/強/中性/弱/超賣）
  - MACD 狀態（金叉/死叉/看多/看空）
  - 均線排列（多頭/空頭/混合）
  - 波動率（極高/高/正常/低）
  - 布林帶位置
  - 成交量狀態
  - 支撐/阻力位
- ✅ 智能進場評分：
  - 檢測逆勢交易（-25分）
  - 檢測震盪市交易（-10分）
  - 檢測 RSI 超買超賣時的錯誤方向（-20分）
  - 檢測 MACD 信號衝突（-15分）
  - 檢測高波動市場使用高槓桿（-15分）
  - 檢測布林帶極端位置交易（-10分）
  - 順勢交易加分（+5分）
- ✅ 進度條顯示評分進度
- ✅ 保存市場分析結果到評分記錄

### v2.6 (2026-02-05)
- ✅ 添加開倉時間、進場價、出場價顯示
- ✅ 添加全選功能（一鍵選擇所有交易）
- ✅ 大幅改進自動評分邏輯：
  - 基於實際數據和指標（持倉時間、盈虧百分比、槓桿、手續費佔比）
  - 更細緻的評分標準（15+ 種問題識別）
  - 自動計算盈虧百分比
  - 詳細的註記生成（包含具體數據）
- ✅ 修復舊數據格式兼容問題（字典 → 列表）
- ✅ 增加表格高度，方便查看更多交易

### v2.5 (2026-02-05)
- ✅ 添加自動評分功能（系統根據交易表現自動計算評分）
- ✅ 增加顯示筆數選項（20/50/100/200/全部）
- ✅ 添加方向和盈虧篩選功能
- ✅ 修復讀取評分時的欄位名稱錯誤
- ✅ 兼容舊數據格式（overall_score → total_score）
- ✅ 添加評分方式統計（手動/自動）
- ✅ 自動評分包含問題識別和改進建議

### v2.4 (2026-02-05)
- ✅ 移除覆盤報告功能（功能不完整，缺少生成入口）
- ✅ 簡化交易覆盤功能為 4 個子功能：
  - BingX 交易分析
  - 交易記錄管理
  - 執行質量評分
  - 虧損分析

### v2.3 (2026-02-05)
- ✅ 添加虧損分析功能
- ✅ 自動分類虧損原因（7種類型）
- ✅ 虧損原因統計和可視化
- ✅ 針對性改進建議
- ✅ 虧損趨勢分析
- ✅ 虧損改善行動計劃
- ✅ 刪除大量重複的文檔（保留核心文檔）

### v2.2 (2026-02-05)
- ✅ 完全整合 ReviewSystem 執行質量評分功能
- ✅ 支持在 Web 界面直接為交易評分
- ✅ 支持多選交易批量評分
- ✅ 添加交易註記和標籤功能
- ✅ 評分趨勢可視化
- ✅ 刪除 example_review_system.py（功能已整合）

### v2.1 (2026-02-05)
- ✅ 添加每日交易頻率分析
- ✅ 添加 ROI 計算（支持手動輸入初始資金）
- ✅ 添加手續費詳細分析
- ✅ 添加手續費優化建議
- ✅ 修復 Perpetual 進場價為 0 的問題
- ✅ 優化配對算法（按槓桿匹配）
- ✅ 移除調試信息，界面更乾淨
- ✅ 刪除重複的分析腳本

### v2.0 (2026-02-05)
- ✅ 完整的 BingX 交易分析
- ✅ 交易記錄管理（上傳、保存、去重）
- ✅ Perpetual 帳戶智能配對
- ✅ 訂單詳細記錄查看
- ✅ 執行質量評分

---

## 🆚 與獨立腳本的對比

| 功能 | Web Dashboard v2 | 獨立腳本 |
|------|-----------------|---------|
| 交易分析 | ✅ 完整 | ❌ 已刪除 |
| 手續費分析 | ✅ 詳細 | ❌ 已刪除 |
| ROI 計算 | ✅ 支持 | ❌ 已刪除 |
| 交易頻率分析 | ✅ 詳細 | ❌ 已刪除 |
| 執行質量評分 | ✅ 完整整合 | ❌ 已刪除 |
| 數據管理 | ✅ 完整 | ❌ 已刪除 |
| 可視化 | ✅ 豐富 | ❌ 已刪除 |
| 易用性 | ✅ 圖形界面 | ❌ 命令行 |

**結論**：所有功能已完全整合到 Web Dashboard v2，不再需要獨立腳本。

## 🗑️ 已刪除的重複腳本

以下腳本的功能已完全整合到 Web Dashboard v2：
- ✅ `完整交易分析.py`
- ✅ `分析你的交易記錄.py`
- ✅ `測試交易分析.py`
- ✅ `分析手續費.py`
- ✅ `正確的手續費分析.py`
- ✅ `手續費優化對比.py`
- ✅ `example_review_system.py`
