# 實際收益率顯示說明

## 更新內容

在交易詳細信息中新增「實際收益率」字段，清楚顯示考慮槓桿後的真實收益。

---

## 顯示佈局

### 第一行（基本信息）
```
┌──────────┬───────┬─────────┬──────┐
│ 交易對   │ 方向  │ 數量    │ 槓桿 │
└──────────┴───────┴─────────┴──────┘
```

### 第二行（收益信息）- 新增實際收益率
```
┌────────────┬────────────┬──────────────┬──────┬──────────┐
│ 盈虧(USDT) │ 價格變動%  │ 實際收益率   │ 總分 │ 評分方式 │
└────────────┴────────────┴──────────────┴──────┴──────────┘
```

---

## 三個收益指標的區別

### 1. 盈虧 (USDT)
**說明**：實際賺到或虧損的金額（扣除手續費後）

**範例**：
- `+125.50 USDT`（賺了 125.50 美元）
- `-85.20 USDT`（虧了 85.20 美元）

---

### 2. 價格變動%（新名稱）
**說明**：價格本身的變動百分比，**不考慮槓桿**

**計算方式**：
```python
# 做多
價格變動% = (出場價 - 進場價) / 進場價 × 100

# 做空
價格變動% = (進場價 - 出場價) / 進場價 × 100
```

**範例**：
- 做多：進場 $42,150，出場 $42,850
  - 價格變動% = (42850 - 42150) / 42150 × 100 = **+1.66%**

- 做空：進場 $78,251，出場 $78,254
  - 價格變動% = (78251 - 78254) / 78251 × 100 = **-0.00%**

**特點**：
- 反映市場價格的實際變動
- 不受槓桿影響
- 用於評估進出場時機

---

### 3. 實際收益率（新增）⭐
**說明**：考慮槓桿後的真實收益率

**計算方式**：
```python
實際收益率 = 價格變動% × 槓桿
```

**範例 1：獲利交易**
- 價格變動%：+1.66%
- 槓桿：20x
- **實際收益率 = 1.66% × 20 = +33.2%** ✅

**範例 2：虧損交易**
- 價格變動%：-0.50%
- 槓桿：50x
- **實際收益率 = -0.50% × 50 = -25.0%** ❌

**範例 3：微小變動**
- 價格變動%：-0.00%（-0.003%）
- 槓桿：60x
- **實際收益率 = -0.003% × 60 = -0.18%** ⚠️

**特點**：
- 反映真實的資金收益率
- 受槓桿放大影響
- 用於評估交易績效

---

## 完整範例

### 範例 1：高槓桿獲利交易

```
第一行：
┌──────────┬──────┬─────────┬──────┐
│ BTC-USDT │ Long │ 0.0500  │ 50x  │
└──────────┴──────┴─────────┴──────┘

第二行：
┌────────────┬────────────┬──────────────┬──────┬──────────┐
│ +250.00 USDT│ +2.00%    │ +100.00% ⬆️  │ 88/100│ 🤖 自動 │
└────────────┴────────────┴──────────────┴──────┴──────────┘
```

**解讀**：
- 價格上漲 2%
- 使用 50 倍槓桿
- 實際收益率 = 2% × 50 = **100%**（翻倍！）
- 賺了 250 USDT

---

### 範例 2：高槓桿虧損交易

```
第一行：
┌──────────┬───────┬─────────┬──────┐
│ ETH-USDT │ Short │ 1.2500  │ 85x  │
└──────────┴───────┴─────────┴──────┘

第二行：
┌────────────┬────────────┬──────────────┬──────┬──────────┐
│ -4.19 USDT │ -0.45%    │ -38.25% ⬇️   │ 51/100│ 🤖 自動 │
└────────────┴────────────┴──────────────┴──────┴──────────┘
```

**解讀**：
- 價格變動 -0.45%（做空時價格上漲）
- 使用 85 倍槓桿
- 實際收益率 = -0.45% × 85 = **-38.25%**（虧損近 4 成！）
- 虧了 4.19 USDT

---

### 範例 3：保守槓桿交易

```
第一行：
┌──────────┬──────┬─────────┬──────┐
│ BTC-USDT │ Long │ 0.1000  │ 5x   │
└──────────┴──────┴─────────┴──────┘

第二行：
┌────────────┬────────────┬──────────────┬──────┬──────────┐
│ +50.00 USDT│ +3.00%    │ +15.00% ⬆️   │ 92/100│ 🤖 自動 │
└────────────┴────────────┴──────────────┴──────┴──────────┘
```

**解讀**：
- 價格上漲 3%
- 使用 5 倍槓桿（保守）
- 實際收益率 = 3% × 5 = **15%**（穩健獲利）
- 賺了 50 USDT

---

## 為什麼需要三個指標？

### 1. 盈虧 (USDT) - 看絕對金額
- **用途**：知道實際賺了或虧了多少錢
- **優點**：直觀，容易理解
- **缺點**：不知道相對於本金的比例

### 2. 價格變動% - 看市場變動
- **用途**：評估進出場時機是否準確
- **優點**：反映市場實際變動，不受槓桿干擾
- **缺點**：不反映真實收益

### 3. 實際收益率 - 看真實績效
- **用途**：評估交易績效和風險
- **優點**：反映真實的資金收益率
- **缺點**：受槓桿放大，可能誤導

---

## 使用建議

### 場景 1：評估進出場時機
**看「價格變動%」**
- 如果價格變動% 很小（< 0.5%），說明進出場時機可能不佳
- 即使實際收益率高，也可能是槓桿太高導致的

### 場景 2：評估交易績效
**看「實際收益率」**
- 這是真實的資金收益率
- 用於計算總體績效和風險

### 場景 3：評估風險
**對比「價格變動%」和「實際收益率」**
- 如果實際收益率 >> 價格變動%，說明槓桿很高
- 高槓桿 = 高風險

**範例**：
- 價格變動%：-0.5%
- 實際收益率：-25%
- 槓桿：50x
- **結論**：槓桿太高！小幅價格變動就導致巨大虧損

---

## 顯示特性

### Tooltip 提示
滑鼠懸停在指標上會顯示說明：
- **價格變動%**：「價格變動百分比（不考慮槓桿）」
- **實際收益率**：「價格變動% × 槓桿」

### 顏色標示
實際收益率會根據盈虧顯示不同顏色：
- **綠色 ⬆️**：獲利（delta="盈利"）
- **紅色 ⬇️**：虧損（delta="虧損"）

---

## 技術細節

### 計算代碼

```python
# 1. 計算價格變動%
if selected_row['direction'] == 'Long':
    pnl_pct = ((exit_price - entry_price) / entry_price) * 100
else:  # Short
    pnl_pct = ((entry_price - exit_price) / entry_price) * 100

# 2. 計算實際收益率
leverage = selected_row.get('leverage', 1)
actual_return = pnl_pct * leverage

# 3. 顯示
st.metric("價格變動%", f"{pnl_pct:+.2f}%", 
         help="價格變動百分比（不考慮槓桿）")

st.metric("實際收益率", f"{actual_return:+.2f}%", 
         delta="盈利" if actual_return > 0 else "虧損",
         help="價格變動% × 槓桿")
```

---

## 常見問題

### Q1：為什麼實際收益率和盈虧(USDT)不一致？
**A**：
- 實際收益率是相對於投入資金的比例
- 盈虧(USDT)是絕對金額
- 兩者的基數不同

**範例**：
- 投入 100 USDT，賺 50 USDT
- 盈虧：+50 USDT
- 實際收益率：+50%

### Q2：實際收益率可能超過 100% 嗎？
**A**：可以！使用高槓桿時很容易超過 100%

**範例**：
- 價格變動：+2%
- 槓桿：100x
- 實際收益率：+200%（翻 3 倍！）

### Q3：為什麼價格變動很小，但實際收益率很大？
**A**：因為槓桿放大效果

**範例**：
- 價格變動：-0.5%
- 槓桿：100x
- 實際收益率：-50%（虧損一半！）

**警告**：這就是高槓桿的風險！

---

## 相關文檔

- `交易詳細信息顯示優化說明.md` - 顯示優化說明
- `交易數量顯示問題解決說明.md` - 數量顯示問題
- `槓桿與風險管理.md` - 槓桿使用建議

---

## 更新日期
2026-02-09

## 版本
v2.1.5
