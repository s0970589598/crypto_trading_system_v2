# 重新評分指南

## 為什麼需要重新評分？

舊的評分記錄缺少以下欄位：
- `open_time`（進場時間）
- `close_time`（出場時間）
- `entry_price`（進場價格）
- `exit_price`（出場價格）

這些欄位是K線圖進出場標記功能所必需的。

## 重新評分步驟

### 1. 備份現有評分（自動完成）
系統會自動備份到：
```
data/review_history/quality_scores_backup_YYYYMMDD_HHMMSS.json
```

### 2. 清除舊評分
1. 打開 Web 界面 v2
2. 進入「📊 交易覆盤」標籤
3. 點擊「🗑️ 清除全部評分」按鈕
4. 確認清除操作

### 3. 重新自動評分
1. 在「📊 交易覆盤」標籤中
2. 選擇要評分的交易（可以全選）
3. 選擇「🤖 自動評分」模式
4. 點擊「⭐ 開始評分」按鈕
5. 等待評分完成

### 4. 驗證結果
1. 選擇任意已評分的交易
2. 點擊「🔍 查看」按鈕
3. 切換到「🔬 市場分析」標籤
4. 檢查是否顯示：
   ```
   🔍 進場時間：2026-02-04 00:57:48 | 出場時間：2026-02-04 01:43:09
   ```
5. 查看K線圖是否有進出場標記

## 預期結果

重新評分後，每筆交易記錄會包含：

```json
{
  "trade_id": "xxx",
  "order_no": "xxx",
  "date": "2026-02-04",
  "symbol": "BTC",
  "direction": "Long",
  "pnl": 10.5,
  "open_time": "2026-02-04 00:57:48",      // ✅ 新增
  "close_time": "2026-02-04 01:43:09",     // ✅ 新增
  "entry_price": 95000.0,                   // ✅ 新增
  "exit_price": 95500.0,                    // ✅ 新增
  "entry_score": 85,
  "exit_score": 90,
  "risk_score": 80,
  "discipline_score": 85,
  "total_score": 85.0,
  "note": "【交易概況】\n• 交易對：BTC\n...",
  "tags": ["auto_scored"],
  "scored_at": "2026-02-06 16:30:00",
  "scoring_mode": "auto",
  "market_analysis": { ... }
}
```

## 注意事項

1. **評分邏輯不變**：重新評分使用相同的評分邏輯，分數應該一致
2. **市場數據**：確保有對應時間的市場數據（15m、1h、4h、1d）
3. **時間消耗**：評分過程需要分析市場數據，可能需要幾分鐘
4. **備份安全**：舊評分會自動備份，可以隨時恢復

## 如果不想重新評分

如果你想保留現有評分，可以手動編輯 `quality_scores.json`：

1. 打開 `data/review_history/quality_scores.json`
2. 對照原始交易數據（`trades.json`）
3. 為每筆評分記錄添加缺失的欄位
4. 保存文件

但這種方法比較繁瑣，建議使用自動重新評分。

## 常見問題

### Q: 重新評分會改變分數嗎？
A: 評分邏輯沒有改變，分數應該一致。但如果市場數據更完整，可能會有細微差異。

### Q: 可以只重新評分部分交易嗎？
A: 可以。清除評分後，只選擇需要的交易進行評分。

### Q: 舊的註記會丟失嗎？
A: 自動評分會重新生成註記。如果有手動添加的註記，建議先備份。

### Q: 重新評分需要多久？
A: 取決於交易數量和市場數據量。通常每筆交易需要 1-2 秒。

## 更新日期

2026-02-06
