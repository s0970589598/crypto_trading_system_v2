# 評分依據完整分析

## 當前使用的評分依據

### ✅ 已使用且合理的依據

#### 1. 市場環境分析
- **趨勢方向**：順勢 vs 逆勢
- **RSI 狀態**：超買/超賣/中性
- **MACD 信號**：金叉/死叉/多空
- **波動率**：高/中/低
- **布林帶位置**：上軌/中軌/下軌
- **成交量**：高/中/低
- **合理性**：✅ 這些都是重要的技術指標

#### 2. 盈虧表現
- **實際收益率**：考慮槓桿的真實收益
- **盈虧比**：風險回報比
- **合理性**：✅ 這是最直接的交易結果

#### 3. 風險控制
- **槓桿使用**：是否過高
- **止損執行**：是否及時
- **手續費佔比**：是否過度交易
- **合理性**：✅ 風險管理是交易的核心

#### 4. 交易紀律
- **平倉方式**：自動 vs 手動
- **爆倉情況**：嚴重違規
- **合理性**：✅ 紀律是長期盈利的關鍵

---

### ⚠️ 已使用但需要調整的依據

#### 1. 持倉時間
**當前問題**：
- 給持倉時間太多權重
- 持倉時間本身不代表品質

**建議調整**：
- 移除持倉時間的加分
- 只在極端情況（< 6分鐘）扣分
- 主要看結果，不看過程

#### 2. 手動平倉
**當前問題**：
- 手動平倉不一定是壞事
- 可能是主動風控

**建議調整**：
- 只在虧損 + 快速手動平倉時扣分
- 獲利手動平倉不扣分（除非獲利太少）

---

### ❌ 未使用但可以考慮的依據

#### 1. 進場價格品質
**說明**：進場價格是否接近最優價格

**如何評估**：
```python
# 做多：進場價接近當根K線的低點 = 好
# 做空：進場價接近當根K線的高點 = 好

if direction == 'Long':
    entry_quality = (high - entry_price) / (high - low)
    # 接近低點 = 1.0（優秀）
    # 接近高點 = 0.0（不佳）
else:  # Short
    entry_quality = (entry_price - low) / (high - low)
    # 接近高點 = 1.0（優秀）
    # 接近低點 = 0.0（不佳）

if entry_quality > 0.8:
    entry_score += 10  # 進場價格優秀
elif entry_quality < 0.2:
    entry_score -= 10  # 進場價格不佳
```

**優先級**：⭐⭐⭐ 高（這是很好的指標）

#### 2. 出場價格品質
**說明**：出場價格是否接近最優價格

**如何評估**：
```python
# 獲利交易：出場價是否接近最高點（做多）或最低點（做空）
# 虧損交易：出場價是否及時（沒有繼續惡化）

if pnl > 0:
    if direction == 'Long':
        # 查看出場後價格是否繼續上漲
        exit_quality = (exit_price - entry_price) / (max_price_after - entry_price)
    else:
        exit_quality = (entry_price - exit_price) / (entry_price - min_price_after)
    
    if exit_quality > 0.8:
        exit_score += 10  # 出場時機優秀
    elif exit_quality < 0.5:
        exit_score -= 5  # 出場過早
```

**優先級**：⭐⭐ 中（需要未來數據，較複雜）

#### 3. 最大浮虧/浮盈
**說明**：持倉期間的最大浮動盈虧

**如何評估**：
```python
# 獲利交易：最大浮虧是否控制良好
if pnl > 0:
    if max_drawdown > entry_price * 0.02:  # 浮虧超過2%
        discipline_score -= 10  # 持倉過程不穩定

# 虧損交易：是否有過浮盈機會
if pnl < 0:
    if max_profit > 0:
        exit_score -= 15  # 有機會獲利但沒把握
```

**優先級**：⭐⭐⭐ 高（反映持倉過程的品質）

#### 4. 進場時機（時間）
**說明**：是否在市場活躍時段交易

**如何評估**：
```python
# 亞洲時段：00:00-08:00（較低波動）
# 歐洲時段：08:00-16:00（中等波動）
# 美洲時段：16:00-24:00（高波動）

hour = entry_time.hour
if 8 <= hour < 16:  # 歐洲時段
    # 波動適中，適合交易
    pass
elif 16 <= hour < 24:  # 美洲時段
    # 波動較大，需要更謹慎
    if leverage > 20:
        entry_score -= 5  # 高波動時段用高槓桿
```

**優先級**：⭐ 低（影響較小）

#### 5. 連續交易表現
**說明**：是否在連續虧損後繼續交易（情緒化）

**如何評估**：
```python
# 查看前3筆交易
recent_trades = get_recent_trades(3)
if all(t['pnl'] < 0 for t in recent_trades):
    # 連續3筆虧損
    discipline_score -= 10  # 可能是情緒化交易
    errors.append("連續虧損後繼續交易，建議休息")
```

**優先級**：⭐⭐ 中（需要歷史數據）

#### 6. 倉位大小
**說明**：單筆交易的倉位佔總資金比例

**如何評估**：
```python
# 需要知道總資金
position_size = quantity * entry_price
position_ratio = position_size / total_capital

if position_ratio > 0.5:  # 單筆超過50%資金
    risk_score -= 20  # 倉位過大
elif position_ratio > 0.3:
    risk_score -= 10
elif position_ratio < 0.1:
    risk_score += 5  # 倉位保守
```

**優先級**：⭐⭐⭐ 高（但需要總資金數據）

#### 7. 加倉/減倉行為
**說明**：是否有加倉或減倉

**如何評估**：
```python
# 獲利加倉 = 好（金字塔加倉）
# 虧損加倉 = 壞（攤平成本）

if has_add_position:
    if pnl_at_add > 0:
        discipline_score += 10  # 獲利加倉
    else:
        discipline_score -= 15  # 虧損加倉（攤平）
```

**優先級**：⭐⭐ 中（需要識別加倉行為）

#### 8. 止損/止盈設置
**說明**：是否設置了止損和止盈

**如何評估**：
```python
if has_stop_loss:
    risk_score += 10  # 設置止損
    
    # 止損距離是否合理
    stop_distance = abs(entry_price - stop_loss) / entry_price
    if stop_distance < 0.01:  # < 1%
        risk_score -= 5  # 止損太近
    elif stop_distance > 0.05:  # > 5%
        risk_score -= 10  # 止損太遠
else:
    risk_score -= 15  # 沒有設置止損
```

**優先級**：⭐⭐⭐ 高（但需要止損數據）

---

## 優先級排序

### 立即可實施（有數據）
1. ⭐⭐⭐ **進場價格品質**：進場價是否接近最優
2. ⭐⭐⭐ **最大浮虧/浮盈**：持倉過程的品質
3. ⭐⭐⭐ **移除持倉時間加分**：調整現有邏輯

### 需要額外數據
4. ⭐⭐⭐ **倉位大小**：需要總資金數據
5. ⭐⭐⭐ **止損/止盈設置**：需要止損數據
6. ⭐⭐ **出場價格品質**：需要未來價格數據
7. ⭐⭐ **連續交易表現**：需要歷史交易數據
8. ⭐⭐ **加倉/減倉行為**：需要識別加倉
9. ⭐ **進場時機（時間）**：影響較小

---

## 當前評分體系的完整性

### 已覆蓋的方面 ✅
- ✅ 市場環境（趨勢、指標）
- ✅ 盈虧表現（收益率、盈虧比）
- ✅ 風險控制（槓桿、止損執行）
- ✅ 交易紀律（平倉方式、爆倉）

### 缺少的方面 ⚠️
- ⚠️ 進場價格品質（可以加）
- ⚠️ 持倉過程品質（可以加）
- ⚠️ 倉位管理（需要數據）
- ⚠️ 止損設置（需要數據）

### 評估
**當前完整性：75%**

對於基本的交易評分已經很完整，但還有提升空間。

---

## 更新日期
2026-02-06
